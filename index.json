[{"categories":["技术"],"content":"安装 下载 wget https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh 安装 sudo ./install-release.sh 启动服务 systemctl enable v2ray \u0026\u0026 systemctl start v2ray ","date":"2022-10-26","objectID":"/v2ray/:0:1","tags":["v2ray","科学上网"],"title":"安全上网工具V2Ray的安装配置","uri":"/v2ray/"},{"categories":["技术"],"content":"配置 WS + TLS这种更安全的方式，依赖web服务器和HTTPS的证书。 域名 域名服务商购买，并创建一个A记录类型，解析到自己的主机IP地址 证书 个人使用时，证书可以不签名，配置客户端时勾选transport setting-\u003eTLS-\u003eTLS allowInsecure 执行openssl命令： openssl req -x509 -subj \"/C=CN/ST=x/L=x/O=x/OU=x/CN=x\" -nodes -days 3650 -newkey rsa:2048 -keyout x.key -out x.crt 重要参数说明： 证书类型 -x509 证书过期时间 -days 3650 天 指定私钥输出文件 -keyout x.key 指定证书输出文件 -out x.crt 证书参数 /C国家 /ST省或州 /L城市 /O组织单位 /OU组织部门 CN通用名（一般填写域名） nginx 关键参数： server_name：x是占位符，需要修改为自己的域名 ssl_certificate和ssl_certificate_key：x是占位符，x.key/x.crt是前面步骤中的openssl生成 配置文件路径/etc/nginx/sites-enabled/x.conf，x是占位符，可以是任意有效文件名（建议用自己的域名），完整内容如下： server { listen 443 ssl; server_name x; ssl_certificate /etc/ssl/certs/x.crt; ssl_certificate_key /etc/ssl/private/x.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location /v2ray { proxy_redirect off; proxy_pass http://127.0.0.1:7879; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header Host $http_host; } } ``` v2ray id可以使用uuidgen生成，配置文件/usr/local/etc/v2ray/config.json，完整内容如下（注：端口7879需要和nginx配置中一致）： { \"log\": { \"access\": \"/var/log/v2ray/access.log\", \"error\": \"/var/log/v2ray/error.log\", \"loglevel\": \"none\" }, \"inbounds\": [{ \"port\": 7879, \"protocol\": \"vmess\", \"settings\": { \"clients\": [{ \"id\": \"4BB35D9A-F164-4237-8FB9-4D3460F1556D\", \"level\": 0, \"alterId\": 0 } ] }, \"streamSettings\": { \"network\": \"ws\", \"wsSettings\": { \"path\": \"/v2ray\" } } } ], \"outbounds\": [{ \"protocol\": \"freedom\" } ] } ","date":"2022-10-26","objectID":"/v2ray/:0:2","tags":["v2ray","科学上网"],"title":"安全上网工具V2Ray的安装配置","uri":"/v2ray/"},{"categories":["技术"],"content":"网络加速 在高延迟，高带宽 的网络环境下，可以开启BBR来加速网络。 开启 echo \"net.core.default_qdisc=fq\" | sudo tee --append /etc/sysctl.conf echo \"net.ipv4.tcp_congestion_control=bbr\" | sudo tee --append /etc/sysctl.conf sudo sysctl -p 确认 lsmod | grep bbr 输出tcp_bbr 20480 1表示成功 ","date":"2022-10-26","objectID":"/v2ray/:0:3","tags":["v2ray","科学上网"],"title":"安全上网工具V2Ray的安装配置","uri":"/v2ray/"},{"categories":["技术"],"content":"EveryAsCode自动化脚本 前置依赖 参数 域名，必选参数 [client_id] client_id，可选参数。默认空时会自动生成一个新的UUID作为client id 例子： sudo ./v2ray-ws+tls-install.sh v2ray.yourdomain.com 4E2D399A-5029-4440-ACA1-7E297FD80EC3 Toolchain apt，nginx，openssl，sysctl，systemctl，unzip 默认nginx，unzip未安装，脚本执行时会自动安装 脚本v2ray-ws+tls-install.sh #!/bin/bash function log_info() { echo -e \"\\033[32m$@\\033[0m\" } function log_warn() { echo -e \"\\033[33m$@\\033[0m\" } function log_error() { echo -e \"\\033[31m$@\\033[0m\" } function main() { local domain=$1 local client_id=$2 if [ -z $client_id ]; then client_id=$(uuidgen) fi log_info 'installing v2ray' systemctl is-enabled v2ray 2\u003e/dev/null if [ $? -ne 0 ]; then wget https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh -o install-release.sh if [ $? -ne 0 ]; then log_error ' download v2ray error' return 1 fi if ! type $cmd \u003e/dev/null 2\u003e\u00261; then apt install unzip -y if [ $? -ne 0 ]; then log_error ' install unzip error' return 1 fi fi chmod +x install-release.sh \u0026\u0026 ./install-release.sh if [ $? -ne 0 ]; then log_error ' install v2ray error' return 1 fi else log_warn ' v2ray has installed' fi log_info 'enabling v2ray service' systemctl enable v2ray if [ $? -ne 0 ]; then log_error ' enable v2ray service error' return 1 fi log_info 'configuring ws+tls' log_info ' generating openssl cert' openssl req -x509 -subj '/C=CN/ST=x/L=x/O=x/OU=x/CN=x' -nodes -days 3650 -newkey rsa:2048 -keyout $domain.key -out $domain.crt if [ $? -ne 0 ]; then log_error ' generate ssl certificate error' return 1 fi cp v2r.afterain.cc.crt /etc/ssl/certs/v2r.afterain.cc.crt cp v2r.afterain.cc.key /etc/ssl/private/v2r.afterain.cc.key log_info ' installing nginx' if ! type $cmd \u003e/dev/null 2\u003e\u00261; then apt install nginx -y if [ $? -ne 0 ]; then log_error ' install nginx error' return 1 fi fi log_info ' configuring nginx' cat \u003c\u003cEOF | tee /etc/nginx/sites-enabled/$domain.conf 2\u003e\u00261 1\u003e/dev/null server { listen 443 ssl; server_name $domain; ssl_certificate /etc/ssl/certs/$domain.crt; ssl_certificate_key /etc/ssl/private/$domain.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location /v2ray { proxy_redirect off; proxy_pass http://127.0.0.1:7879; proxy_http_version 1.1; proxy_set_header Upgrade \\$http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header Host \\$http_host; } } EOF log_info 'configuring v2ray' cat \u003c\u003cEOF | tee /usr/local/etc/v2ray/config.json 2\u003e\u00261 1\u003e/dev/null { \"log\": { \"access\": \"/var/log/v2ray/access.log\", \"error\": \"/var/log/v2ray/error.log\", \"loglevel\": \"none\" }, \"inbounds\": [{ \"port\": 7879, \"protocol\": \"vmess\", \"settings\": { \"clients\": [{ \"id\": \"$client_id\", \"level\": 0, \"alterId\": 0 } ] }, \"streamSettings\": { \"network\": \"ws\", \"wsSettings\": { \"path\": \"/v2ray\" } } } ], \"outbounds\": [{ \"protocol\": \"freedom\" } ] } EOF log_info 'starting bbr' grep 'net.core.default_qdisc=fq' /etc/sysctl.conf if [ $? -ne 0 ]; then echo 'net.core.default_qdisc=fq' | tee --append /etc/sysctl.conf fi grep 'net.ipv4.tcp_congestion_control=bbr' /etc/sysctl.conf if [ $? -ne 0 ]; then echo 'net.ipv4.tcp_congestion_control=bbr' | tee --append /etc/sysctl.conf fi sysctl -p 2\u003e\u00261 1\u003e/dev/null if [ $? -ne 0 ]; then log_error ' start bbr error' return 1 fi log_info 'restarting service' log_info ' restarting nginx service' systemctl restart nginx if [ $? -ne 0 ]; then log_error ' restart nginx error' return 1 fi log_info ' restarting v2ray service' systemctl restart v2ray if [ $? -ne 0 ]; then log_error ' restart v2ray error' return 1 fi log_info 'v2ray connfigure info:' log_info \" address: $domain\" log_info \" port: 443\" log_info \" client id: $client_id\" log_info \" transport-\u003enetwork: ws\" log_info \" transport-\u003epath: /v2ray\" log_info \" transport-\u003etls: Use TLS\" log_info \" transport-\u003etls-\u003eallowInsecure: true\" log_info \" transport-\u003etls-\u003eallowInsecure: true\" log_info \" transport-\u003etls-\u003eserverName: $domain\" } if [ -n \"$BASH_SOURCE\" -a \"$BASH_SOURCE\" == \"$0\" ]; then if [ \"$(id -u)\" != \"0\" ]; then log_error ","date":"2022-10-26","objectID":"/v2ray/:0:4","tags":["v2ray","科学上网"],"title":"安全上网工具V2Ray的安装配置","uri":"/v2ray/"},{"categories":["技术"],"content":"安装 选择区域 Tokyo, Zone A (ap-northeast-1a) 选择系统 Platform： Linux blueprint： OS Only =\u003e Debian 11.4 选择配置/费用 配置：1vCPU/512MB 流量：1TB流量 注意流量的规则较为复杂：流量=输入+输出 所以在代理方式使用场景下，相当于实际512GB流量 折算为7x24小时不间断使用带宽=512*1000/30/86400*8～=1.58Mbps，个人使用基本够用 超出流量后： 输入的免费（相当于lightsail从外部下载的内容） 输出的额外收费（相当于代理从lightsail下载的内容） 所以超出的流量实际相当于半价 费用：3.5$/月 ","date":"2022-10-26","objectID":"/lightsail/:0:1","tags":["AWS","科学上网"],"title":"安装配置lightsail","uri":"/lightsail/"},{"categories":["技术"],"content":"配置防火墙 开放端口： 22/80/443 默认已经开放22和80端口，只需要新增443端口即可 ","date":"2022-10-26","objectID":"/lightsail/:0:2","tags":["AWS","科学上网"],"title":"安装配置lightsail","uri":"/lightsail/"},{"categories":["技术"],"content":"SSH登陆 系统的SSH默认配置不允许密码登陆，需要先下载私钥 默认账号admin，ssh admin@xxx ","date":"2022-10-26","objectID":"/lightsail/:0:3","tags":["AWS","科学上网"],"title":"安装配置lightsail","uri":"/lightsail/"},{"categories":["技术"],"content":"其他 根据实际需要安装代理等 ","date":"2022-10-26","objectID":"/lightsail/:0:4","tags":["AWS","科学上网"],"title":"安装配置lightsail","uri":"/lightsail/"},{"categories":["技术"],"content":"EveryAsCode自动化脚本 lightsail支持CLI和API 前置依赖 用户 从安全考虑，为自动化创建lightsail实例新建专用账号 权限 创建专用policy，只赋予必要权限。这样即使不小心泄漏了用户的AK，也不会造成太大的危害 创建实例和配置防火墙权限： lightsail:CreateInstances lightsail:OpenInstancePublicPorts 查询系统（blueprint）和配置（bundle）权限： lightsail:GetBlueprints lightsail:GetBundles SSH Key 如果不使用默认SSH Key，可以创建一个 Toolchain AWS CLI 执行aws configure配置Access Key ID，Secret Access Key和Default region name（ap-northeast-1） 脚本create-lightsail.sh #!/bin/bash INSTANCE_NAME='debian-11-v2ray' ret=$(aws lightsail get-instance --no-cli-pager \\ --instance-name $INSTANCE_NAME | grep 'NotFoundException') if [ ! -z $ret ]; then aws lightsail create-instances --no-cli-pager \\ --instance-names $INSTANCE_NAME \\ --availability-zone ap-northeast-1a \\ --blueprint-id debian_11 \\ --bundle-id nano_2_0 \\ --ip-address-type ipv4 \\ --key-pair-name macbook-pro if [ $? -ne 0 ]; then echo -e \"\\033[31mcreate instance error\\033[0m\" exit 1 fi else echo -e \"\\033[32m$INSTANCE_NAME is exist\\033[0m\" fi aws lightsail open-instance-public-ports --no-cli-pager \\ --instance-name $INSTANCE_NAME \\ --port-info fromPort=443,protocol=TCP,toPort=443 if [ $? -ne 0 ]; then echo -e \"\\033[31mopen public port 443 error\\033[0m\" exit 1 fi echo -n -e \"\\033[32mpublic ip:\\033[0m\" aws lightsail get-instance --no-cli-pager \\ --instance-name $INSTANCE_NAME \\ | grep publicIpAddress | awk '{print $2}' | awk -F ',' '{print $1}' ","date":"2022-10-26","objectID":"/lightsail/:0:5","tags":["AWS","科学上网"],"title":"安装配置lightsail","uri":"/lightsail/"},{"categories":["技术"],"content":"什么是GitHub Pages GitHub Pages是通过git仓库来管理个人或项目网站。 优势 文章不丢失 使用git（分布式代码管理工具）管理文章内容，能安全可靠的保存文章，以及所有的历史变更记录。 免维护工作和无成本 避免个人网站的各种维护工作和成本 成本：购买服务器/带宽/存储等费用 维护工作：https证书申请/轮换，网站安全，系统管理等等 自定义域名 很多blog服务也能保证文章丢失，也不需要维护工作和成本，但是很少支持使用自己的自定义域名。这个能让网站看起来是一个独立的个人网站，和Github完全无关。 劣势 不支持动态网站 如果只是用来写文章/记录各种心得，静态网站能完全满足需求。但是如果需要实验建站的各种前后端技术，就不太适合了。 ","date":"2022-10-25","objectID":"/githubpages/:0:1","tags":["建站"],"title":"使用GitHub免费搭建个人网站","uri":"/githubpages/"},{"categories":["技术"],"content":"如何使用GitHub Pages 关键步骤 注册github账号 创建git仓库 注意仓库名必须是username.github.io形式，username是GitHub的用户名 编辑内容 主页文件：index.html 先通过git clone代码仓库，然后创建/编辑文件，最后在提交代码成功时，会自动发布到网站 自定义域名 需要先在自己的域名提供商中配置： 增加解析 记录类型： CNAME 主机记录： @ （直接解析主域名，例如github.io） 记录值： username.github.io （username替换为GitHub的用户名） 如果需要解析例如www.github.io，则在增加一条解析，其他参数相同，主机记录设置为： www 即可。 详细文档以及GitHub本身的配置参考GitHub Pages配置文档 基本过程是在对应的git仓库中设置，链接：https://github.com/usename/usename.github.io/settings/pages（username替换为GitHub的用户名） 分支 默认是main 域名 填写自己的域名 HTTPS 勾选Enforce HTTPS，不能通过HTTP访问，强制设置为HTTPS访问。 ","date":"2022-10-25","objectID":"/githubpages/:0:2","tags":["建站"],"title":"使用GitHub免费搭建个人网站","uri":"/githubpages/"},{"categories":["技术"],"content":"静态网站工具 静态网站的工具非常多，例如GitHub官方支持的Jekyll，还有Hugo/Hexo/VuePress/Nuxt.js等。 每个工具的使用方法各有特色，但是基本原理都是有一个build步骤，把内容编译成html/js/css文件，并输出到一个public目录。然后把http服务的根目录设置为public目录即可访问。 ","date":"2022-10-25","objectID":"/githubpages/:0:3","tags":["建站"],"title":"使用GitHub免费搭建个人网站","uri":"/githubpages/"},{"categories":["技术"],"content":"静态网站工具如何结合GitHub Pages GitHub支持workflows的功能，能在提交代码后自动执行指定的任务。只要把任务配置为静态网站工具的build就能自动发布内容了。 以Hugo工具为例，详细参考Host on GitHub 设置任务 先在git仓库的根目录的.github/workflows新建gh-pages.yml文件，内容如下： name: github pages on: push: branches: - main # Set a branch to deploy pull_request: jobs: deploy: runs-on: ubuntu-22.04 steps: - uses: actions/checkout@v3 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: 'latest' extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 if: github.ref == 'refs/heads/main' with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public 修改GitHub Pages配置 上面设置的任务中，实际是把main分支的内容，经过Hogo的build，把public下所有内容重新提交到gh-pages分支根目录下。所以只要把GitHub Pages配置中的分支参数修改为： gh-pages，即可以实现提交代码自动发布到网站的功能。 ","date":"2022-10-25","objectID":"/githubpages/:0:4","tags":["建站"],"title":"使用GitHub免费搭建个人网站","uri":"/githubpages/"},{"categories":null,"content":"AFTERAIN ","date":"2022-09-29","objectID":"/about/:0:0","tags":null,"title":"About","uri":"/about/"},{"categories":["技术"],"content":"安装系统 下载 操作系统镜像 树莓派有很多发行版，官方支持的Raspberry Pi OS就有多个版本（桌面版本，桌面版本+推荐软件，精简版）可供选择。场景是用树莓派做服务器，不连接显示器/键盘/鼠标，所以选择的精简版。 下载安装程序Raspberry Pi Imager 安装程序运行在PC电脑上，支持在windows/Ubuntu/macOS多种操作系统下使用。 安装 Raspberry Pi Imager只要3步就能把操作系统写入SD卡：选择 操作系统镜像 -\u003e 选择 SD卡 -\u003e 写入 分区 安装程序在SD卡上创建了两个分区：boot(启动)分区和root(系统)根分区 boot包含了启动最关键的linux内核文件。分区是vfat格式。现在常用的PC操作系统windows/Linux/macOS都能直接访问（读写文件） root包含了除内核之外，操作系统的各种文件（二进制/配置等），分区是ext4格式。Linux各种发行版默认都支持ext4格式，但是大家常用的windows/macOS系统PC电脑是无法直接访问的（需要安装特殊软件才支持）。 所以安装完成后，如果把SD卡重新插入PC电脑，windows/macOS只能看到一个boot磁盘。 ","date":"2022-09-29","objectID":"/raspberrypi/:0:1","tags":["树莓派"],"title":"安装配置RaspberryPi","uri":"/raspberrypi/"},{"categories":["技术"],"content":"无显示器启动时的配置机制 其实在安装系统完成后，只需要把SD卡插入树莓派中，接通电源即可启动系统使用了。不过由于不接显示器/键盘/鼠标，所以需要在启动前先配置好网络和SSH服务（远程登录控制），否则无法使用。 由于大家常用的windows/macOS系统PC电脑无法直接访问root分区，也就无法修改配置文件。这时树莓派提供了一个有趣的方案，只要在boot分区按照规范的文件名和格式创建好相关配置，就会在启动时自动加载。具体支持哪些，参考官方配置文档。 后面的wifi配置和SSH服务都使用了这个机制。 ","date":"2022-09-29","objectID":"/raspberrypi/:0:2","tags":["树莓派"],"title":"安装配置RaspberryPi","uri":"/raspberrypi/"},{"categories":["技术"],"content":"配置wifi网络 配置文件 在boot磁盘的根目录创建文件wpa_supplicant.conf ,内容如下： country=CN ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev update_config=1 network={ ssid=\"xxx\" psk=\"yyy\" key_mgmt=WPA-PSK priority=1 } 根据实际情况修改ssid（wifi网络名）和psk（wifi密码）两个参数即可。其实key_mgmt也需要根据实际情况修改，不过考虑安全性，家庭wifi一般都推荐使用WPA-PSK。 如何获取IP地址 启动树莓派后，登录路由器，查看客户端名称是raspberrypi的IP地址即可。 最好使用路由器提供的“手工指定IP地址”的方法，给树莓派一个固定的IP。一般需要先在路由器查询已DHCP分配的客户端列表，找到raspberrypi对应的MAC地址，然后进行设置。 这样树莓派就可以作为固定IP地址的服务器使用了。 ","date":"2022-09-29","objectID":"/raspberrypi/:0:3","tags":["树莓派"],"title":"安装配置RaspberryPi","uri":"/raspberrypi/"},{"categories":["技术"],"content":"配置SSH服务 在boot磁盘的根目录创建文件ssh或ssh.txt，文件内容为空即可。这样树莓派启动时会开启SSH服务，默认的账号是pi，密码是raspberry。 ","date":"2022-09-29","objectID":"/raspberrypi/:0:4","tags":["树莓派"],"title":"安装配置RaspberryPi","uri":"/raspberrypi/"},{"categories":["技术"],"content":"更改apt源 SSHssh pi@xxx.xxx.xxx.xxx登录树莓派，输入默认密码raspberry 修改文件etc/apt/sources.list（改为清华提供的源），内容如下： deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main non-free contrib deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main non-free contrib 执行apt-get update更新源信息 ","date":"2022-09-29","objectID":"/raspberrypi/:0:5","tags":["树莓派"],"title":"安装配置RaspberryPi","uri":"/raspberrypi/"}]